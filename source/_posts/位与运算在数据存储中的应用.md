---
title: 位运算在数据存储中应用
comments: true
type: categories
categories: 数据库
tags:
  - 大数据
date: 2017-10-10
description:
---



经常会遇到一个id 对应多个状态的情况发生，如果按照以往的数据存储习惯，假设id为a的数据有四种情况：



| id   | flag |
| ---- | ---- |
| a    | 1    |
| a    | 2    |
| a    | 3    |
| a    | 4    |



如果用状态位来表示这4种状态，事先定义好， 2^0 :1,2^1:2,2^2:3,2^3:4,之后把他们相加  可以得到总数



| flag | 二进制存储  |
| ---- | ------ |
| 1    | 0001=1 |
| 2    | 0010=2 |
| 3    | 0100=4 |
| 4    | 1000=8 |



之后相加的话得到总数：

| flag | 二进制存储 |
| ---- | ----- |
| 15   | 1111  |



于是库里id存储可以变为：

| id   | flag_new |
| ---- | -------- |
| a    | 15       |



这个10就已经代表了之前的4种状态，如果需要分别取其中的状态时候，只要相应位进行与运算即可。

比如从这张表中查找之前状态为2的数据：

`select id from t where id & int(pow(2,2)) =int(pow(2,2))`

1111 & 0010 =0010   代表flag=2



通过与运算就可以用一个状态位来表示多个状态，只要在相应的状态上有值就可以。
